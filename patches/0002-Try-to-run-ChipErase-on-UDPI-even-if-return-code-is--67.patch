From b5847ba97418d6b436c62b9d96f5a0be30280474 Mon Sep 17 00:00:00 2001
From: Umberto Baldi <u.baldi@arduino.cc>
Date: Tue, 3 May 2022 16:16:39 +0200
Subject: [PATCH] Try to run ChipErase on UPDI even if return code is -67 More
 details in
 https://github.com/arduino/ArduinoCore-megaavr/issues/33#issuecomment-495613256

Co-authored-by: Martino Facchin <m.facchin@arduino.cc>
---
 src/main.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/main.c b/src/main.c
index 253c6e5..27c7743 100644
--- a/src/main.c
+++ b/src/main.c
@@ -1118,7 +1118,7 @@ int main(int argc, char * argv [])
       rc = avr_signature(pgm, p);
       if (rc != 0) {
         // -68 == -(0x44) == -(RSP3_FAIL_OCD_LOCKED)
-        if ((rc == -68) && (p->flags & AVRPART_HAS_UPDI) && (attempt < 1)) {
+        if ((rc == -68 || rc == -67) && (p->flags & AVRPART_HAS_UPDI) && (attempt < 1)) {
           attempt++;
           if (pgm->read_sib) {
              // Read SIB and compare FamilyID
-- 
2.17.1

